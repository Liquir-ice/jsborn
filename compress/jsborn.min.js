(function(l){var f=jQuery,m="on",n="off";7>f.fn.jquery.split(".")[1]&&(m="bind",n="unbind");var b={version:"0.5a",event:{on:m,off:n},data:{cores:{},clss:{},plugins:{},imports:[]},config:{console:!0,createImport:!1,extendPlugins:[],importSetup:{library:"",source:"",parserURL:function(a){return a}}},addListener:function(a,c,d){f(b)[b.event.on]("jsb."+a,{scope:d},c)},create:function(a,c,d){var g=b;g.config.createImport&&g._check_class(a);var e=g._get_class(a);if(!e)return g.echo("error","CLASS:NOT FIND",
a),!1;if(e.config.abstr)return g.echo("error","CLASS:ABSTR",a),!1;e.config.nodes||(e.config.nodes=[]);if(e.config.single&&0<e.config.nodes.length)return g.echo("error","CLASS:SINGLE",a),!1;a=new e.cls(c);e.config.nodes.push(a);d||f(g).triggerHandler("jsb.create",a);return a},echo:function(a){if(console&&b.config.console)if(console[a])console[a](arguments);else b.echo("log","console no "+a+" method.")},extendCore:function(a,c){b.core||(b.core={});var d=c.config.name;if(b._get_core(d))return b.echo("log",
"Core: "+d+" already register."),b._get_core(d);c.config=f.extend(c.config,{single:!0,abstr:!1,plugin:!1,core:!0});b.core[a]=b.create(d);b.data.cores[d]=b.core[a];return b.core[a]},extendPlugin:function(a){var c=a.cls.prototype.depends,d=a.config.name,g=b;if(g._get_plugin(d))return g.echo("log","Plugin: "+a+" already register."),g._get_plugin(d);if(f.isArray(c))for(var e=0;e<c.length;e++)g._check_class(c[e])||g.echo("error","PLUGINS:"+d+" depends CLASS:"+c[e]+" not found");a.config=f.extend(a.config,
{single:!0,abstr:!1,plugin:!0,core:!1});g.data.plugins[d]=g.create(d);return g.data.plugins[d]},getClassData:function(){return b.data.clss},getImportData:function(){return b.data.imports},importClass:function(a){var c="",d=!0;if(b._check_import(a))return!0;c=b._parser_url(a);c=b.config.importSetup.parserURL(c);f.ajax({url:c,dataType:"script",async:!1,error:function(a,e,f){d=!1;b.echo("error","Require:"+c+" Message:"+f)},success:function(){b.data.imports.push({name:c,status:d})}});return d},removeListener:function(a){f(b).off("jsb."+
a)},setConfig:function(a){f.extend(!0,this.config,a);return this.config},_check_import:function(a){for(var c=0;c<b.data.imports.length;c++)if(b.data.imports[c].name==a)return b.echo("log","same",b.data.imports[c],a),!0;return!1},_check_class:function(a){return this._get_class(a)?!0:this.importClass(a)},_init:function(){this._init_oop()},_init_oop:function(){var a=this;a.cls=function(c,d){if(a._get_class(c))return a.echo("warn","CLASS:'"+c+"' define again"),!0;var b=function(e){var h=this.extend;h&&
(a._check_class(h),f.extend(b.prototype,a.cls.prototype,a._get_class(h).cls.prototype,d));h=a._get_class(c);d.plugins=d.plugins?d.plugins:[];this.plugins=this.plugins?this.plugins:[];this.plugins=f.merge(this.plugins,d.plugins);if(!h.config.plugin&&!h.config.core){this.plugins=f.merge(this.plugins,a.config.extendPlugins);var k=[];f.each(this.plugins,function(c,a){-1==f.inArray(a,k)&&k.push(a)});this.plugins=k}this.className=c;this._count=0;this._destroy=!1;this._ary_extend=[];this._ary_plugin=[];
this._plugin_init(b);this._extend(this);this._import();this.initialize(e);this.SUPER();delete this._count;return!0};f.extend(b.prototype,a.cls.prototype,d);!0!==d.single&&(d.single=!1);!0!==d.abstr&&(d.abstr=!1);a.data.clss[c]={config:{name:c,single:d.single,abstr:d.abstr,plugin:!1,core:!1},cls:b};return a.data.clss[c]};a.cls.prototype={extend:"",_ary_extend:[],_ary_plugin:[],_plugin_init:function(c){var d=this.plugins,b;if(d){for(var e=0;e<d.length;e++)a._check_class(d[e]),b=a._get_class(d[e]).cls.prototype,
this._ary_plugin.push(d[e]),this._plugin(b);for(e=0;e<this._ary_plugin.length;e++)b=a._get_class(this._ary_plugin[e]).cls.prototype,f.extend(c.prototype,a._get_plugin(this._ary_plugin[e]).getPrototype()),b.initialize.call(this)}},_plugin:function(c){if(c=c.depends)for(var a=0;a<c.length;a++){var f=c[a],e=b._get_class(f);e.config.plugin&&(this._ary_plugin.push(f),e.cls.prototype.depends&&this._plugin(e.cls.prototype))}},_extend:function(a){var d=a.extend;d&&(this._ary_extend.push(a.extend),a=b._get_class(d).cls,
a.prototype.extend&&this._extend(a.prototype))},_import:function(){if(this.imports)for(var a=0;a<this.imports.length;a++)b._check_class(this.imports[a])},SUPER:function(){if(0<this._ary_extend.length&&this._count<this._ary_extend.length){var a=this._ary_extend[this._count];a&&(a=b._get_class(a).cls.prototype,this._count++,a._import(),a.initialize.apply(this),a.extend&&this.SUPER())}},destroy:function(){if(this._destroy)return b.echo("error",this,"already destroy"),!0;for(var a=b._get_class(this.className),
d=0;d<a.config.nodes.length;d++)a.config.nodes[d]==this&&a.config.nodes.splice(d,1);f(this).triggerHandler("cls.destroy",this);f(b).triggerHandler("jsb.destroy",this);this._destroy=!0;return this},addListener:function(a,d,g){f(this)[b.event.on]("cls."+a,{scope:g},d)},dispatchEvent:function(a,b){f(this).triggerHandler("cls."+a,[this,b])},removeListener:function(a){f(this)[b.event.off]("cls."+a)},initialize:function(){}}},_parser_url:function(a){var c="";a.match(/^(http|https):\/\//g)?(c=a.match(/^(https|http):\/\/(.*?)\//g)[0].replace(/(https|http|:|\/)/g,
""),c!=l.location.hostname&&b.echo("error","imports need sample domain",a),c=a):(c=a.replace(/\\/g,"/").replace(/.*\//,""),".js"!=c.substr(c.length,-3)?(c=a.replace(/\./g,"/"),c=a.match(/^jsborn\./g)?b.config.importSetup.library+c+".js":b.config.importSetup.source+c+".js"):c=a);return c},_get_core:function(a){return this.data.cores[a]?this.data.cores[a]:!1},_get_class:function(a){return this.data.clss[a]?this.data.clss[a]:!1},_get_plugin:function(a){return this.data.plugins[a]?this.data.plugins[a]:
!1}};b._init();l.JSB=b})(window);